import {Component} from "@k8slens/extensions";
import React from "react";
import {VulnerabilityReport} from "../vulnerability-report";
import {VulnerabilitiesList} from "./vulnerabilities-list";

export interface VulnerabilityReportDetailsProps extends Component.KubeObjectDetailsProps<VulnerabilityReport> {

    /*
     * Determines whether to display container name with a little rectangle.
     * If the rectangle is green there are no action. If it's red it means
     * that there are some critical or high vulnerabilities and it's a good
     * idea to check them out.
     */
    showContainerStatus?: boolean

    /*
     * Determines whether to display ObjectMeta section or not.
     * We want to display it in the generic VulnerabilityReport view.
     * However, we want to hide it when we list VulnerabilityReports
     * in the WorkloadVulnerabilities details pane.
     */
    showObjectMeta?: boolean
}

export class VulnerabilityReportDetails extends React.Component<VulnerabilityReportDetailsProps> {

    render() {
        const {object: report} = this.props;
        if (!report) return null;
        return (
            <div className="PodDetailsContainer">
                {this.props.showContainerStatus &&
                <div className="pod-container-title">
                    <Component.StatusBrick
                        className="error"/>{report.metadata.labels['starboard.container.name']}
                </div>}

                {this.props.showObjectMeta &&
                <Component.KubeObjectMeta object={report}
                                          hideFields={["uid", "resourceVersion", "selfLink"]}/>}

                <Component.DrawerItem name="Image">
                    {report.report.registry.server + '/' + report.report.artifact.repository + ':' + report.report.artifact.tag}
                </Component.DrawerItem>

                <Component.DrawerItem name="Critical">
                    {report.report.summary.criticalCount}
                </Component.DrawerItem>
                <Component.DrawerItem name="High">
                    {report.report.summary.highCount}
                </Component.DrawerItem>
                <Component.DrawerItem name="Medium">
                    {report.report.summary.mediumCount}
                </Component.DrawerItem>
                <Component.DrawerItem name="Low">
                    {report.report.summary.lowCount}
                </Component.DrawerItem>
                <Component.DrawerItem name="Unknown">
                    {report.report.summary.unknownCount}
                </Component.DrawerItem>

                <Component.DrawerItem name="Vulnerabilities">
                    <Component.DrawerParamToggler label={report.report.vulnerabilities.length}>
                        <VulnerabilitiesList vulnerabilities={report.report.vulnerabilities}/>
                    </Component.DrawerParamToggler>
                </Component.DrawerItem>

            </div>
        )
    }
}
